<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Art Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #e8e8e8;
        }
        h1 {
            color: #333;
            position: absolute;
            top: 20px;
        }
        #container {
            display: flex;
        }
        #tools {
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-right: 1px solid #ccc;
            background-color: #f9f9f9;
            min-width: 150px;
        }
        #pixelCanvas {
            border: 1px solid #ccc;
            cursor: crosshair;
            image-rendering: pixelated;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #palette {
            display: flex;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .colorBox {
            width: 30px;
            height: 30px;
            border: 1px solid #999;
            margin: 1px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .colorBox:hover {
            transform: scale(1.1);
            border: 1px solid #333;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.2s;
        }
        button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        #gridSize {
            margin: 5px;
        }
    </style>
</head>
<body>

<h1>Pixel Art Creator</h1>

<div id="container">
    <div id="tools">
        <h3>Paleta de Cores</h3>
        <div id="palette"></div>
        <button id="clearCanvas">Limpar</button>
        <button id="saveImage">Salvar Imagem</button>
        <input type="file" id="loadPalette" accept="image/*" style="margin: 5px;">
        <button id="loadPaletteButton">Carregar Paleta</button>
        <label for="gridSize">Tamanho da Grade:</label>
        <input type="range" id="gridSize" min="1" max="64" value="16" style="width: 200px;">
    </div>
    <canvas id="pixelCanvas" width="480" height="480"></canvas>
</div>

<script>
    const canvas = document.getElementById("pixelCanvas");
    const ctx = canvas.getContext("2d");
    const paletteDiv = document.getElementById("palette");
    const gridSizeInput = document.getElementById("gridSize");

    let currentColor = "#000000";
    let gridSize = 16;

    function drawGrid() {
        const size = canvas.width / gridSize;
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpa o canvas antes de desenhar a grade
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                ctx.strokeStyle = "#dddddd";
                ctx.strokeRect(i * size, j * size, size, size);
            }
        }
    }

    function fillPixel(x, y) {
        const size = canvas.width / gridSize;
        ctx.fillStyle = currentColor;
        ctx.fillRect(Math.floor(x / size) * size, Math.floor(y / size) * size, size, size);
    }

    canvas.addEventListener("mousedown", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        fillPixel(x, y);
        canvas.addEventListener("mousemove", onPaint);
    });

    canvas.addEventListener("mouseup", () => {
        canvas.removeEventListener("mousemove", onPaint);
    });

    function onPaint(e) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        fillPixel(x, y);
    }

    function createPalette() {
        paletteDiv.innerHTML = ''; // Limpa a paleta antes de recriá-la
        for (let i = 0; i < 8; i++) {
            const color = "#" + Math.floor(Math.random() * 16777215).toString(16);
            const colorBox = document.createElement("div");
            colorBox.className = "colorBox";
            colorBox.style.backgroundColor = color;
            colorBox.onclick = () => {
                currentColor = color;
            };
            paletteDiv.appendChild(colorBox);
        }
    }

    document.getElementById("clearCanvas").onclick = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
    };

    document.getElementById("saveImage").onclick = () => {
        const link = document.createElement('a');
        link.download = 'pixel_art.png';
        link.href = canvas.toDataURL("image/png");
        link.click();
    };

    gridSizeInput.oninput = (e) => {
        gridSize = e.target.value;
        drawGrid();
    };

    document.getElementById("loadPalette").onchange = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                const paletteSize = Math.sqrt(img.width * img.height);
                const colors = [];
                for (let i = 0; i < paletteSize; i++) {
                    const colorData = ctx.getImageData(i * (img.width / paletteSize), 0, img.width / paletteSize, img.height / paletteSize);
                    const pixelData = colorData.data;
                    const r = pixelData[0];
                    const g = pixelData[1];
                    const b = pixelData[2];
                    colors.push(`rgb(${r},${g},${b})`);
                }
                createPaletteFromColors(colors);
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    };

    function createPaletteFromColors(colors) {
        paletteDiv.innerHTML = ''; // Limpa a paleta antes de recriá-la
        colors.forEach(color => {
            const colorBox = document.createElement("div");
            colorBox.className = "colorBox";
            colorBox.style.backgroundColor = color;
            colorBox.onclick = () => {
                currentColor = color;
            };
            paletteDiv.appendChild(colorBox);
        });
    }

    document.getElementById("loadPaletteButton").onclick = createPalette;

    createPalette();
    drawGrid();
</script>

</body>
</html>
